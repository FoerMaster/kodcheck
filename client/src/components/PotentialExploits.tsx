import { useToast } from "@/hooks/use-toast";
import { highlightCode } from "@/utils/codeHighlight";
import { FaLock, FaShieldAlt, FaCopy, FaCheck, FaExclamationTriangle, FaCode } from "react-icons/fa";

interface Exploit {
  id: string;
  title: string;
  description: string;
  severity: string;
  filePath: string;
  lineNumber: number;
  code: string;
  recommendation: string;
}

interface PotentialExploitsProps {
  exploits: Exploit[];
}

export default function PotentialExploits({ exploits }: PotentialExploitsProps) {
  const { toast } = useToast();
  
  const copyToClipboard = (text: string) => {
    navigator.clipboard.writeText(text);
    toast({
      title: "Скопировано в буфер обмена",
      description: "Фрагмент кода успешно скопирован",
    });
  };
  
  return (
    <div className="space-y-6" id="exploits">
      <div className="flex items-center space-x-2 mb-2">
        <FaLock className="text-amber-500 w-5 h-5" />
        <h2 className="text-2xl font-bold">Потенциальные эксплойты</h2>
      </div>
      
      {exploits.length > 0 ? (
        <div className="space-y-6">
          {exploits.map(exploit => (
            <div 
              key={exploit.id}
              className="bg-gray-800 rounded-lg border border-gray-700 overflow-hidden shadow-md"
            >
              {/* Exploit header */}
              <div className="bg-gradient-to-r from-red-900/40 to-amber-900/40 p-4 flex flex-col md:flex-row md:items-center md:justify-between border-b border-gray-700">
                <div className="flex items-start space-x-3">
                  <div className={`${
                    exploit.severity === 'critical' ? 'bg-red-500/20 text-red-500' : 'bg-amber-500/20 text-amber-500'
                  } p-2 rounded-full border ${
                    exploit.severity === 'critical' ? 'border-red-600/50' : 'border-amber-600/50'
                  }`}>
                    <FaExclamationTriangle />
                  </div>
                  <div>
                    <h3 className="font-bold text-gray-100">{exploit.title}</h3>
                    <p className="text-sm text-gray-300">
                      <span className="font-mono bg-gray-700/50 px-1.5 py-0.5 rounded mr-1 text-xs">
                        {exploit.filePath}:{exploit.lineNumber}
                      </span>
                    </p>
                  </div>
                </div>
                <div className="mt-3 md:mt-0">
                  <span className={`px-2 py-1 rounded text-xs font-medium border ${
                    exploit.severity === 'critical' 
                      ? 'bg-red-500/20 text-red-400 border-red-600/50' 
                      : 'bg-amber-500/20 text-amber-400 border-amber-600/50'
                  }`}>
                    {exploit.severity === 'critical' ? 'КРИТИЧЕСКИЙ РИСК' : 'РИСК БЕЗОПАСНОСТИ'}
                  </span>
                </div>
              </div>
              
              {/* Exploit body */}
              <div className="p-6">
                <div className="mb-6">
                  <h4 className="text-sm font-medium text-amber-400 uppercase tracking-wider mb-2 flex items-center">
                    <FaShieldAlt className="mr-2 h-3 w-3" />
                    Описание проблемы
                  </h4>
                  <div className="bg-gray-900 rounded-lg p-4 text-sm border border-gray-700">
                    <p className="text-gray-300">{exploit.description}</p>
                  </div>
                </div>
                
                <div className="mb-6">
                  <h4 className="text-sm font-medium text-amber-400 uppercase tracking-wider mb-2 flex items-center">
                    <FaCode className="mr-2 h-3 w-3" />
                    Уязвимый код
                  </h4>
                  <div className="bg-gray-900 rounded-lg p-4 font-mono text-sm overflow-x-auto relative border border-gray-700">
                    <button 
                      className="absolute top-2 right-2 text-amber-400 hover:text-amber-300 bg-amber-600/20 hover:bg-amber-600/30 p-1.5 rounded"
                      onClick={() => copyToClipboard(exploit.code)}
                      title="Копировать код"
                    >
                      <FaCopy className="h-3 w-3" />
                    </button>
                    <pre
                      className="text-amber-300"
                      dangerouslySetInnerHTML={{ __html: highlightCode(exploit.code) }}
                    ></pre>
                  </div>
                </div>
                
                <div>
                  <h4 className="text-sm font-medium text-amber-400 uppercase tracking-wider mb-2 flex items-center">
                    <FaShieldAlt className="mr-2 h-3 w-3" />
                    Рекомендации по устранению
                  </h4>
                  <div className="bg-red-900/10 border border-red-700/20 rounded-lg p-4 text-sm">
                    <p className="text-gray-300">{exploit.recommendation}</p>
                  </div>
                </div>
              </div>
            </div>
          ))}
        </div>
      ) : (
        <div className="bg-gray-800 rounded-lg border border-gray-700 p-8 text-center shadow-md overflow-hidden">
          <div className="bg-green-500/20 h-16 w-16 rounded-full flex items-center justify-center mx-auto mb-4 border border-green-500/30">
            <FaCheck className="h-8 w-8 text-green-500" />
          </div>
          <h3 className="text-xl font-medium mb-2">Эксплойтов не обнаружено!</h3>
          <p className="text-gray-400">Ваш сервер защищен от известных уязвимостей безопасности.</p>
        </div>
      )}
    </div>
  );
}
